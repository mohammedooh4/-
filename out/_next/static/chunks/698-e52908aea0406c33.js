"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{172:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2523:(e,t,s)=>{s.d(t,{p:()=>l});var a=s(5155),r=s(2115),i=s(9434);let l=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});l.displayName="Input"},2698:(e,t,s)=>{s.d(t,{ProductView:()=>H});var a=s(5155),r=s(2115),i=s(5695),l=s(285),n=s(6766),o=s(6874),c=s.n(o),d=s(6695),m=s(3991),u=s(4469),f=s(7481);function h(e){let{product:t}=e,{addToCart:s}=(0,u._)(),{toast:r}=(0,f.dj)(),i=()=>{s(t),r({title:"✅ تمت الإضافة إلى السلة",description:'"'.concat(t.name,'" أصبح الآن في سلتك.')})};return(0,a.jsx)("div",{className:"group block cursor-pointer",onClick:i,tabIndex:0,onKeyDown:e=>"Enter"===e.key&&i(),children:(0,a.jsxs)(d.Zp,{className:"h-full overflow-hidden transition-all duration-300 ease-in-out hover:shadow-xl hover:-translate-y-1.5 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded-lg flex flex-col group-focus:ring-2 group-focus:ring-primary group-focus:ring-offset-2 bg-card/50",children:[(0,a.jsx)(d.aR,{className:"p-0",children:(0,a.jsx)(m.g,{ratio:1,className:"bg-muted",children:(0,a.jsx)(n.default,{src:t.image,alt:t.image_alt,"data-ai-hint":t.ai_hint,fill:!0,className:"object-cover transition-transform duration-300 ease-in-out group-hover:scale-105"})})}),(0,a.jsxs)(d.Wu,{className:"p-4 flex-grow flex flex-col",children:[(0,a.jsx)(c(),{href:"/products/".concat(t.id),onClick:e=>{e.stopPropagation()},className:"flex-grow",children:(0,a.jsx)("h3",{className:"text-lg font-medium tracking-normal mb-1 truncate group-hover:underline",children:t.name})}),(0,a.jsx)("div",{className:"flex justify-between items-center mt-2",children:(0,a.jsx)("p",{className:"text-xl font-semibold text-primary",children:t.price.toLocaleString("ar-IQ",{style:"currency",currency:"IQD",minimumFractionDigits:0,maximumFractionDigits:0,currencyDisplay:"code"}).replace("IQD","د.ع")})})]})]})})}function x(e){let{products:t}=e;return(0,a.jsx)("div",{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-16 border-2 border-dashed rounded-lg mt-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-destructive",children:"لا توجد منتجات حاليا"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"يرجى المحاولة مرة أخرى لاحقاً."})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8",children:t.map(e=>(0,a.jsx)(h,{product:e},e.id))})})}var p=s(157);let g=(0,p.A)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),y=(0,p.A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),j=(0,p.A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var N=s(172),v=s(3985),b=s(2523),w=s(4838),k=s(5821),C=s(2085),S=s(5318),_=s(9434);let I=k.bL,R=k.l9,E=k.bm,A=k.ZL,D=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(k.hJ,{className:(0,_.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});D.displayName=k.hJ.displayName;let L=(0,C.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),M=r.forwardRef((e,t)=>{let{side:s="right",className:r,children:i,...l}=e;return(0,a.jsxs)(A,{children:[(0,a.jsx)(D,{}),(0,a.jsxs)(k.UC,{ref:t,className:(0,_.cn)(L({side:s}),r),...l,children:[i,(0,a.jsxs)(k.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(S.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});M.displayName=k.UC.displayName;let z=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,_.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};z.displayName="SheetHeader";let T=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(k.hE,{ref:t,className:(0,_.cn)("text-lg font-semibold text-foreground",s),...r})});function H(e){let{initialProducts:t,initialCategories:s,activeCategoryId:n,categoryName:o}=e,[c,d]=(0,r.useTransition)(),m=(0,i.useRouter)(),u="".concat("products_cache_").concat(n||"home"),f="".concat(u,"_ts"),[h,p]=(0,r.useState)(t),[k,C]=(0,r.useState)(1),[S,_]=(0,r.useState)(!1),[A,D]=(0,r.useState)(!0),[L,H]=(0,r.useState)(""),[Q,$]=(0,r.useState)(!1),F=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(L)return;let e=sessionStorage.getItem(u),t=sessionStorage.getItem(f);if(e&&t&&Date.now()-parseInt(t,10)<15e3)try{let t=JSON.parse(e);Array.isArray(t)&&t.length>0&&(console.log("Restoring from cache:",u,t.length),p(t),C(Math.ceil(t.length/20)))}catch(e){console.error("Cache parse error",e)}},[u,f,L]),(0,r.useEffect)(()=>{if(!L&&h.length>0)try{let e=h.slice(0,50).map(e=>{var t,s;return{id:e.id,name:e.name,price:e.price,image:(null==(t=e.image)?void 0:t.startsWith("data:"))?"https://placehold.co/600x400.png":e.image,image_alt:e.image_alt,category_id:e.category_id,stock:e.stock,description:(null==(s=e.description)?void 0:s.substring(0,100))||"",ai_hint:""}});sessionStorage.setItem(u,JSON.stringify(e)),sessionStorage.setItem(f,Date.now().toString())}catch(e){console.warn("Cache saving failed (Quota Exceeded), clearing old cache:",e);try{sessionStorage.removeItem(u),sessionStorage.removeItem(f)}catch(e){}}},[h,u,f,L]),(0,r.useEffect)(()=>{let e=setTimeout(async()=>{L.trim()?($(!0),D(!1),p(await (0,v.zh)(L)),$(!1)):""!==L||Q||(p(t),C(1),D(!0))},500);return()=>clearTimeout(e)},[L,t]);let J=(0,r.useCallback)(()=>{d(()=>{m.refresh(),sessionStorage.removeItem(u),sessionStorage.removeItem(f),p(t),C(1),D(!0),H("")})},[m,u,f,t]),V=(0,r.useCallback)(async()=>{if(S||!A||L)return;_(!0);let e=k+1;try{let t=await (0,v.P_)(e,20,n);0===t.length?D(!1):(p(e=>{let s=new Set(e.map(e=>e.id)),a=t.filter(e=>!s.has(e.id));return[...e,...a]}),C(e))}catch(e){console.error("Error loading more products:",e)}finally{_(!1)}},[k,S,A,L,n]);return(0,r.useEffect)(()=>{let e=new IntersectionObserver(e=>{e[0].isIntersecting&&!S&&A&&!L&&V()},{threshold:.1});return F.current&&e.observe(F.current),()=>{F.current&&e.unobserve(F.current)}},[V,S,A,L]),(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8 md:py-12",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[(0,a.jsxs)(I,{children:[(0,a.jsx)(R,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"outline",size:"icon",className:"shrink-0 sm:hidden",children:[(0,a.jsx)(g,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"sr-only",children:"Categories"})]})}),(0,a.jsxs)(M,{side:"bottom",className:"sm:hidden",children:[(0,a.jsx)(z,{children:(0,a.jsx)(T,{children:"الفئات"})}),(0,a.jsxs)("div",{className:"grid gap-2 py-4",children:[(0,a.jsx)(E,{asChild:!0,children:(0,a.jsx)(l.$,{variant:"ghost",className:"justify-start",onClick:()=>m.push("/"),children:"كل المنتجات"})}),s.map(e=>(0,a.jsx)(E,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"ghost",className:"justify-start gap-2",onClick:()=>m.push("/category/".concat(e.id)),children:[(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:e.icon||""},className:"[&_svg]:w-4 [&_svg]:h-4"}),e.name]})},e.id))]})]})]}),(0,a.jsx)("div",{className:"hidden sm:block",children:(0,a.jsxs)(w.rI,{children:[(0,a.jsx)(w.ty,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"outline",size:"icon",className:"shrink-0",children:[(0,a.jsx)(g,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"sr-only",children:"Categories"})]})}),(0,a.jsxs)(w.SQ,{align:"start",className:"w-56",children:[(0,a.jsx)(w._2,{onSelect:()=>m.push("/"),className:"cursor-pointer",children:"كل المنتجات"}),s.map(e=>(0,a.jsxs)(w._2,{onSelect:()=>m.push("/category/".concat(e.id)),className:"w-full cursor-pointer flex items-center gap-2",children:[(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:e.icon||""},className:"[&_svg]:w-4 [&_svg]:h-4"}),e.name]},e.id))]})]})}),(0,a.jsx)("h1",{className:"text-2xl font-bold tracking-tight text-nowrap",children:o||"اسواق سجاد"})]}),(0,a.jsxs)("div",{className:"relative w-full md:max-w-md",children:[(0,a.jsx)(y,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(b.p,{placeholder:"ابحث عن المنتج",className:"pr-9",value:L,onChange:e=>H(e.target.value)})]}),(0,a.jsx)(l.$,{variant:"ghost",size:"icon",onClick:J,disabled:c,className:"hidden md:inline-flex",children:(0,a.jsx)(j,{className:"h-5 w-5 ".concat(c?"animate-spin":"")})})]}),Q?(0,a.jsx)("div",{className:"flex justify-center py-12",children:(0,a.jsx)(N.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,a.jsx)(x,{products:h}),!L&&A&&(0,a.jsx)("div",{ref:F,className:"flex justify-center py-8",children:S?(0,a.jsx)(N.A,{className:"h-8 w-8 animate-spin text-primary"}):(0,a.jsx)("div",{className:"h-4"})}),!L&&!A&&h.length>0&&(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"وصلت لنهاية المنتجات"}),0===h.length&&!Q&&(0,a.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"لا توجد منتجات"})]})}T.displayName=k.hE.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(k.VY,{ref:t,className:(0,_.cn)("text-sm text-muted-foreground",s),...r})}).displayName=k.VY.displayName},3991:(e,t,s)=>{s.d(t,{g:()=>a}),s(2115);let a=s(5859).b},6695:(e,t,s)=>{s.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>l,aR:()=>n,wL:()=>m});var a=s(5155),r=s(2115),i=s(9434);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});l.displayName="Card";let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",s),...r})});n.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});o.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",s),...r})});d.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",s),...r})});m.displayName="CardFooter"}}]);